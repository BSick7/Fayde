<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script type="text/javascript">
        Matrix.prototype = new Object;
        Matrix.prototype.constructor = Matrix;
        function Matrix() {
            this._Elements = Matrix.CreateIdentityArray();
        }
        Matrix.prototype.GetElements = function () {
            return this._Elements;
        };
        Matrix.prototype.SetElement = function (i, j, value) {
            this._Elements[i][j] = value;
        };
        Matrix.prototype.Apply = function (ctx) {
            var elements = this.GetElements();
            ctx.transform(elements[0][0], elements[1][0], elements[0][1], elements[1][1], elements[0][2], elements[1][2]);
        };
        Matrix.prototype.Multiply = function (val) {
            //            if (val instanceof Point) {
            //                var result = new Point();
            //                val = [[val2.X], [val2.Y], [0]];
            //                for (var i = 0; i < 3; i++) {
            //                    result.X += this._Elements[0][i] * val[i][0];
            //                    result.Y += this._Elements[1][i] * val[i][0];
            //                }
            //                return result;
            //            }
            //            if (val instanceof Matrix) {
            //            }

            var result = new Matrix();
            var arr1 = this.GetElements();
            var arr2 = val.GetElements();
            for (var i = 0; i < arr1.length; i++) {
                result[i] = new Array();
                for (var j = 0; j < arr2.length; j++) {
                    var temp = 0;
                    for (var k = 0; k < arr2[j].length; k++) {
                        temp += arr1[i][k] * arr2[k][j];
                    }
                    result.SetElement(i, j, temp);
                }
            }
            return result;

            //            NotImplemented("Matrix.Multiply");

        };
        Matrix.CreateIdentityArray = function () {
            return [
                [1, 0, 0],
                [0, 1, 0],
                [0, 0, 1]
            ];
        };
        Matrix.prototype.toString = function () {
            var t = new String();
            t += "[\n";
            var arr = this.GetElements();
            for (var i = 0; i < arr.length; i++) {
                t += "[";
                for (var j = 0; j < arr[i].length; j++) {
                    t += arr[i][j].toString();
                    t += ",";
                }
                t = t.substr(0, t.length - 1)
                t += "],\n";
            }
            t = t.substr(0, t.length - 2);
            t += "\n]";
            return t;
        };

        TranslationMatrix.prototype = new Matrix;
        TranslationMatrix.prototype.constructor = TranslationMatrix;
        function TranslationMatrix(x, y) {
            Matrix.call(this);
            this.X = x == null ? 0 : x;
            this.Y = y == null ? 0 : y;
        }
        TranslationMatrix.prototype.GetElements = function () {
            return [
                [1, 0, this.X],
                [0, 1, this.Y],
                [0, 0, 1]
            ];
        };
        TranslationMatrix.prototype.Apply = function (ctx) {
            ctx.translate(this.X, this.Y);
        };
    </script>
    <script type="text/javascript">
        //setTimeout(function () { alert("Async"); }, 1);
        //var baseDate = new Date();
        //alert("Starting timer");
        var mat1 = new Matrix();
        var mat2 = new TranslationMatrix(1, 1);
        var result = mat1.Multiply(mat2);
        alert(mat1);
        alert(mat2);
        alert(result);
    </script>
</head>
<body>

</body>
</html>
