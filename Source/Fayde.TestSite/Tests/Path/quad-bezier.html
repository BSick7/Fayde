<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="/Fayde/Fayde.js"></script>
    <script src="util.js"></script>
    <script type="text/javascript">
        var config = {
            w: 800,
            h: 800,
            bg: "#eeeeee"
        };
        var canvas;
        var ctx;
        var info;

        function load() {
            var canvas = addCanvas(config);
            ctx = canvas.getContext("2d");
            info = document.getElementById("info");
            go();
        }

        function go() {
            var s = randomPoint(0, config.w, 0, config.h);
            var rnd = randomQuadBezier();

            var path = new Fayde.Path.RawPath();
            path.Move(s.x, s.y);
            path.QuadraticBezier(rnd.cpx, rnd.cpy, rnd.x, rnd.y);

            var strokePars = randomStrokeParameters();

            ctx.clearRect(0, 0, config.w, config.h);
            path.DrawCanvasCtx(ctx);
            pathStroke(ctx, "rgb(0,0,0)", strokePars);

            drawGuideLine(ctx, s.x, s.y, rnd.cpx, rnd.cpy, 1);
            drawGuideLine(ctx, rnd.cpx, rnd.cpy, rnd.x, rnd.y, 2);

            drawStartPoint(ctx, s.x, s.y);
            drawControlPoint(ctx, rnd.cpx, rnd.cpy, 1);
            drawEndPoint(ctx, rnd.x, rnd.y);

            drawBoundingBox(path, strokePars);

            var m = getMaxima(s.x, rnd.cpx, rnd.x, s.y, rnd.cpy, rnd.y);
            drawPoint(ctx, m[0].x, m[0].y, "#0aaa00");
            drawPoint(ctx, m[1].x, m[1].y, "#0aaa00");
            console.log(m[0].t);
            console.log(m[1].t);

            dumpinfo(strokePars);
        }

        function randomQuadBezier() {
            var cpx = randomInt(0, config.w);
            var cpy = randomInt(0, config.h);
            var x = randomInt(0, config.w);
            var y = randomInt(0, config.h);

            return {
                cpx: cpx,
                cpy: cpy,
                x: x,
                y: y
            };
        }

        function dumpinfo(pars) {
            info.innerText = strokeParamsToString(pars);
        }

        
        function getMaxima(x1, x2, x3, y1, y2, y3) {
            //change in x direction
            var m1 = {
                t: (x1 - x2) / (x1 - 2 * x2 + x3),
                x: 0,
                y: 0
            };
            m1.x = xoft(x1, x2, x3, m1.t);
            m1.y = xoft(y1, y2, y3, m1.t);
        
            //change in y direction
            var m2 = {
                t: (y1 - y2) / (y1 - 2 * y2 + y3),
                x: 0,
                y: 0
            };
            m2.y = xoft(y1, y2, y3, m2.t);
            m2.x = xoft(x1, x2, x3, m2.t);

            return [m1, m2];
        }
        function xoft(a, b, c, t) {
            // x(t) = a(1-t)^2 + 2*b(1-t)t + c*t^2
            // "change of direction" point (dx/dt = 0)
            return (a * Math.pow(1 - t, 2)) + (2 * b * (1 - t) * t) + (c * Math.pow(t, 2));
        }
    </script>
</head>
<body onload="load()">
    <input type="button" value="again" onclick="go()" />
    <span id="info"></span>
    <br />
</body>
</html>